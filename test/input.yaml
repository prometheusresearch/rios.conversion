title: RIOS.CONVERSION
tests:
  - sh: pip install --quiet rios.core
    ignore: true

  - sh: pip install --quiet flake8
    ignore: true

  # check Python source syntax and style
  - sh: flake8 ./src
  
  - rmdir: ./test/sandbox
  - mkdir: ./test/sandbox
  
  # Check boilerplate commands
  - sh: redcap-rios --help
  - sh: redcap-rios --version
  - sh: qualtrics-rios --help
  - sh: qualtrics-rios --version

  # redcap_1  fields, with calculations and skip logic
  - sh: !
        redcap-rios 
            --title test_redcap_1
            --id urn:redcap_1
            --instrument-version 1.0 
            --infile ./test/redcap_1.csv
            --outfile-prefix ./test/sandbox/test_redcap_1
  - sh: cat ./test/sandbox/test_redcap_1_c.yaml
  - sh: cat ./test/sandbox/test_redcap_1_f.yaml
  - sh: cat ./test/sandbox/test_redcap_1_i.yaml

  - sh: !
        redcap-rios 
            --title test_redcap_1
            --id urn:redcap_1
            --instrument-version 1.0 
            --infile ./test/redcap_1.csv
            --outfile-prefix ./test/sandbox/test_redcap_1
            --format json 
  - sh: cat ./test/sandbox/test_redcap_1_c.json
  - sh: cat ./test/sandbox/test_redcap_1_f.json
  - sh: cat ./test/sandbox/test_redcap_1_i.json
  - sh: rios-validate instrument ./test/sandbox/test_redcap_1_i.json
  - sh: !
        rios-validate 
            --instrument ./test/sandbox/test_redcap_1_i.json
            form ./test/sandbox/test_redcap_1_f.json
  - sh: !
        rios-validate 
            --instrument ./test/sandbox/test_redcap_1_i.json
            calculationset ./test/sandbox/test_redcap_1_c.json
                    
  # redcap_matrix_1   simple form with one matrix
  - sh: !
        redcap-rios 
            --title test_redcap_matrix_1
            --id urn:redcap_matrix_1
            --instrument-version 1.0 
            --infile ./test/redcap_matrix_1.csv
            --outfile-prefix ./test/sandbox/test_redcap_matrix_1
  - sh: cat ./test/sandbox/test_redcap_matrix_1_f.yaml
  - sh: cat ./test/sandbox/test_redcap_matrix_1_i.yaml

  - sh: !
        redcap-rios 
            --title test_redcap_matrix_1
            --id urn:redcap_matrix_1
            --instrument-version 1.0 
            --infile ./test/redcap_1.csv
            --outfile-prefix ./test/sandbox/test_redcap_matrix_1
            --format json 
  - sh: rios-validate instrument ./test/sandbox/test_redcap_matrix_1_i.json
  - sh: !
        rios-validate 
            --instrument ./test/sandbox/test_redcap_matrix_1_i.json
            form ./test/sandbox/test_redcap_matrix_1_f.json

  # qualtrics_health
  - sh: !
        qualtrics-rios 
            --instrument-version 1.0 
            --infile ./test/qualtrics_health.qsf
            --outfile-prefix ./test/sandbox/test_qualtrics_health
  - sh: cat ./test/sandbox/test_qualtrics_health_f.yaml
  - sh: cat ./test/sandbox/test_qualtrics_health_i.yaml

  - sh: !
        qualtrics-rios 
            --instrument-version 1.0 
            --infile ./test/qualtrics_health.qsf
            --outfile-prefix ./test/sandbox/test_qualtrics_health
            --format json 
  - sh: rios-validate instrument ./test/sandbox/test_qualtrics_health_i.json
  - sh: !
        rios-validate 
            --instrument ./test/sandbox/test_qualtrics_health_i.json
            form ./test/sandbox/test_qualtrics_health_f.json

  # qualtrics_neuro
  - sh: !
        qualtrics-rios 
            --instrument-version 1.0 
            --infile ./test/qualtrics_neuro.qsf
            --outfile-prefix ./test/sandbox/test_qualtrics_neuro
  - sh: cat ./test/sandbox/test_qualtrics_neuro_f.yaml
  - sh: cat ./test/sandbox/test_qualtrics_neuro_i.yaml

  - sh: !
        qualtrics-rios 
            --instrument-version 1.0 
            --infile ./test/qualtrics_neuro.qsf
            --outfile-prefix ./test/sandbox/test_qualtrics_neuro
            --format json 
  - sh: rios-validate instrument ./test/sandbox/test_qualtrics_neuro_i.json
  - sh: !
        rios-validate 
            --instrument ./test/sandbox/test_qualtrics_neuro_i.json
            form ./test/sandbox/test_qualtrics_neuro_f.json

  - sh: python ./test/test_date.py
  - sh: python ./test/test_math.py
